<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3大指标判定引擎逻辑图</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .diagram-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .flow-diagram {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            border: 2px solid #e9ecef;
        }

        .flow-diagram h2 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .flow-step {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .flow-step::after {
            content: '↓';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: #667eea;
            font-weight: bold;
        }

        .flow-step:last-child::after {
            display: none;
        }

        .step-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .step-description {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .priority-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            color: white;
            margin-right: 8px;
        }

        .priority-high {
            background: #dc3545;
        }

        .priority-medium {
            background: #fd7e14;
        }

        .priority-low {
            background: #6c757d;
        }

        .threshold-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .threshold-table th,
        .threshold-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        .threshold-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .threshold-table .level-0 {
            background: #d4edda;
            color: #155724;
        }

        .threshold-table .level-1 {
            background: #d1ecf1;
            color: #0c5460;
        }

        .threshold-table .level-2 {
            background: #fff3cd;
            color: #856404;
        }

        .threshold-table .level-3 {
            background: #f8d7da;
            color: #721c24;
        }

        .threshold-table .level-4 {
            background: #f5c6cb;
            color: #721c24;
        }

        .algorithm-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .algorithm-section h2 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 20px;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            overflow-x: auto;
        }

        .comment {
            color: #68d391;
        }

        .formula {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            text-align: center;
            font-size: 1.1em;
        }

        .decision-tree {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .decision-node {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #667eea;
            text-align: center;
            position: relative;
        }

        .decision-branch {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }

        .branch-option {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 0 10px;
            border: 2px solid #28a745;
            text-align: center;
        }

        .branch-option.fail {
            border-color: #dc3545;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧠 3大指标判定引擎逻辑图</h1>
            <p>基于优先级保护的智能书签提醒判定系统</p>
        </div>

        <div class="diagram-container">
            <!-- 主要流程图 -->
            <div class="flow-diagram">
                <h2>🔄 核心判定流程</h2>

                <div class="flow-step">
                    <div class="step-title">
                        <span class="priority-indicator priority-high">P1</span>
                        访问次数判定
                    </div>
                    <div class="step-description">
                        • 检查近3天内访问次数<br>
                        • 基础阈值：3次<br>
                        • 具有一票否决权<br>
                        • 失败则直接返回未通过
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-title">
                        <span class="priority-indicator priority-medium">P2</span>
                        访问时长判定
                    </div>
                    <div class="step-description">
                        • 检查活跃浏览时长<br>
                        • 基础阈值：30秒<br>
                        • 排除误点击和快速离开<br>
                        • 失败则直接返回未通过
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-title">
                        <span class="priority-indicator priority-low">P3</span>
                        访问深度判定
                    </div>
                    <div class="step-description">
                        • 检查页面滚动深度<br>
                        • 基础阈值：1.5屏<br>
                        • 衡量内容关注度<br>
                        • 失败则直接返回未通过
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-title">
                        <span class="priority-indicator priority-high">⚖️</span>
                        综合加权计算
                    </div>
                    <div class="step-description">
                        • 访问次数权重：50%<br>
                        • 访问时长权重：30%<br>
                        • 访问深度权重：20%<br>
                        • 计算加权总分
                    </div>
                </div>

                <div class="flow-step">
                    <div class="step-title">
                        <span class="priority-indicator priority-high">🛡️</span>
                        优先级保护
                    </div>
                    <div class="step-description">
                        • 访问次数具有保护作用<br>
                        • 防止低访问次数获得高级别<br>
                        • 调整最终判定级别<br>
                        • 确保判定合理性
                    </div>
                </div>
            </div>

            <!-- 阈值配置表 -->
            <div class="flow-diagram">
                <h2>📊 阈值配置表</h2>

                <h3>访问次数阈值（3天内）</h3>
                <table class="threshold-table">
                    <tr>
                        <th>级别</th>
                        <th>阈值</th>
                        <th>描述</th>
                    </tr>
                    <tr class="level-0">
                        <td>基础关注</td>
                        <td>3次</td>
                        <td>最小关注度</td>
                    </tr>
                    <tr class="level-1">
                        <td>适度关注</td>
                        <td>5次</td>
                        <td>中等关注度</td>
                    </tr>
                    <tr class="level-2">
                        <td>高度关注</td>
                        <td>8次</td>
                        <td>高度关注度</td>
                    </tr>
                    <tr class="level-3">
                        <td>强烈关注</td>
                        <td>12次</td>
                        <td>强烈关注度</td>
                    </tr>
                    <tr class="level-4">
                        <td>极度关注</td>
                        <td>20次</td>
                        <td>极度关注度</td>
                    </tr>
                </table>

                <h3>访问时长阈值（秒）</h3>
                <table class="threshold-table">
                    <tr>
                        <th>级别</th>
                        <th>阈值</th>
                        <th>描述</th>
                    </tr>
                    <tr class="level-0">
                        <td>快速浏览</td>
                        <td>30秒</td>
                        <td>排除误点击</td>
                    </tr>
                    <tr class="level-1">
                        <td>初步关注</td>
                        <td>60秒</td>
                        <td>1分钟关注</td>
                    </tr>
                    <tr class="level-2">
                        <td>认真浏览</td>
                        <td>90秒</td>
                        <td>1.5分钟专注</td>
                    </tr>
                    <tr class="level-3">
                        <td>深度关注</td>
                        <td>120秒</td>
                        <td>2分钟深度</td>
                    </tr>
                    <tr class="level-4">
                        <td>长时间专注</td>
                        <td>180秒</td>
                        <td>3分钟专注</td>
                    </tr>
                </table>

                <h3>访问深度阈值（屏幕数）</h3>
                <table class="threshold-table">
                    <tr>
                        <th>级别</th>
                        <th>阈值</th>
                        <th>描述</th>
                    </tr>
                    <tr class="level-0">
                        <td>基础滚动</td>
                        <td>1.5屏</td>
                        <td>基础滚动</td>
                    </tr>
                    <tr class="level-1">
                        <td>适度深度</td>
                        <td>3.0屏</td>
                        <td>中等深度</td>
                    </tr>
                    <tr class="level-2">
                        <td>深度浏览</td>
                        <td>5.0屏</td>
                        <td>深度浏览</td>
                    </tr>
                    <tr class="level-3">
                        <td>很深浏览</td>
                        <td>8.0屏</td>
                        <td>很深浏览</td>
                    </tr>
                    <tr class="level-4">
                        <td>极深浏览</td>
                        <td>12.0屏</td>
                        <td>极深浏览</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- 算法详细说明 -->
        <div class="algorithm-section">
            <h2>⚙️ 核心算法详解</h2>

            <h3>1. 加权分数计算</h3>
            <div class="formula">
                加权分数 = (访问次数级别 × 0.5) + (访问时长级别 × 0.3) + (访问深度级别 × 0.2)
            </div>

            <div class="code-block">
<span class="comment">// 权重配置</span>
weights = {
  visit: 0.5,      <span class="comment">// 访问次数权重50%</span>
  duration: 0.3,   <span class="comment">// 访问时长权重30%</span>
  depth: 0.2       <span class="comment">// 访问深度权重20%</span>
}

<span class="comment">// 加权分数计算</span>
weightedScore = (visitLevel × weights.visit) +
                (durationLevel × weights.duration) +
                (depthLevel × weights.depth)
            </div>

            <h3>2. 优先级保护机制</h3>
            <div class="code-block">
<span class="comment">// 应用优先级保护</span>
function applyPriorityProtection(weightedScore, visitLevel, durationLevel, depthLevel) {
  let finalLevel = Math.round(weightedScore);

  <span class="comment">// 访问次数保护机制</span>
  if (visitLevel === 0 && finalLevel > 1) finalLevel = 1;
  if (visitLevel === 1 && finalLevel > 2) finalLevel = 2;

  <span class="comment">// 访问时长调节机制</span>
  if (durationLevel === 0 && finalLevel > 1) finalLevel = Math.max(0, finalLevel - 1);

  return Math.max(0, Math.min(4, finalLevel));
}
            </div>

            <h3>3. 置信度计算</h3>
            <div class="formula">
                置信度 = (访问次数达成度 × 0.5) + (访问时长达成度 × 0.3) + (访问深度达成度 × 0.2)
            </div>

            <div class="code-block">
<span class="comment">// 计算各指标达成度</span>
visitConfidence = Math.min(1, actualVisitCount / thresholdVisitCount)
durationConfidence = Math.min(1, actualDuration / thresholdDuration)
depthConfidence = Math.min(1, actualDepth / thresholdDepth)

<span class="comment">// 加权平均置信度</span>
confidence = (visitConfidence × weights.visit) +
              (durationConfidence × weights.duration) +
              (depthConfidence × weights.depth)
            </div>
        </div>

        <!-- 决策树 -->
        <div class="decision-tree">
            <h2>🌳 决策逻辑树</h2>

            <div class="decision-node">
                <strong>开始判定</strong><br>
                <small>接收3大指标数据</small>
            </div>

            <div class="decision-branch">
                <div class="branch-option">
                    <strong>访问次数 ≥ 3次</strong><br>
                    <small>继续下一级判定</small>
                </div>
                <div class="branch-option fail">
                    <strong>访问次数 < 3次</strong><br>
                    <small>❌ 判定失败</small>
                </div>
            </div>

            <div class="decision-node">
                <strong>访问时长判定</strong><br>
                <small>检查浏览时长</small>
            </div>

            <div class="decision-branch">
                <div class="branch-option">
                    <strong>访问时长 ≥ 30秒</strong><br>
                    <small>继续下一级判定</small>
                </div>
                <div class="branch-option fail">
                    <strong>访问时长 < 30秒</strong><br>
                    <small>❌ 判定失败</small>
                </div>
            </div>

            <div class="decision-node">
                <strong>访问深度判定</strong><br>
                <small>检查滚动深度</small>
            </div>

            <div class="decision-branch">
                <div class="branch-option">
                    <strong>访问深度 ≥ 1.5屏</strong><br>
                    <small>进入综合计算</small>
                </div>
                <div class="branch-option fail">
                    <strong>访问深度 < 1.5屏</strong><br>
                    <small>❌ 判定失败</small>
                </div>
            </div>

            <div class="decision-node">
                <strong>✅ 综合判定通过</strong><br>
                <small>计算最终级别和置信度</small>
            </div>
        </div>

        <!-- 系统统计 -->
        <div class="algorithm-section">
            <h2>📈 系统特性统计</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">3</div>
                    <div class="stat-label">核心指标数量</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">5</div>
                    <div class="stat-label">关注级别数量</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">100%</div>
                    <div class="stat-label">权重总和</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">5分钟</div>
                    <div class="stat-label">提醒冷却时间</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">Level 2+</div>
                    <div class="stat-label">提醒触发阈值</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3天</div>
                    <div class="stat-label">访问次数统计周期</div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #dc3545;"></div>
                    <span>高优先级 (P1)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #fd7e14;"></div>
                    <span>中优先级 (P2)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #6c757d;"></div>
                    <span>低优先级 (P3)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #28a745;"></div>
                    <span>通过判定</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #dc3545;"></div>
                    <span>失败判定</span>
                </div>
            </div>
        </div>
    </div>
</body>
</html>