<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3å¤§æŒ‡æ ‡åˆ¤å®šå¼•æ“é›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .test-item {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        .test-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        .status-passed {
            background: #28a745;
        }
        .status-failed {
            background: #dc3545;
        }
        .status-pending {
            background: #6c757d;
        }
        .test-actions {
            margin-top: 15px;
        }
        button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
            background: #667eea;
            color: white;
        }
        button:hover {
            background: #5a6fd8;
        }
        .test-output {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .integration-info {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .integration-info h2 {
            color: #1976d2;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  3å¤§æŒ‡æ ‡åˆ¤å®šå¼•æ“é›†æˆæµ‹è¯•</h1>

        <div class="integration-info">
            <h2>âœ… é›†æˆå®Œæˆæƒ…å†µ</h2>
            <p><strong>åˆ¤å®šå¼•æ“çŠ¶æ€ï¼š</strong> å·²æˆåŠŸé›†æˆåˆ°ä¹¦ç­¾ç®¡ç†å™¨ä¸­</p>
            <p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
            <ul>
                <li>âœ… 3å¤§æŒ‡æ ‡åˆ¤å®šå¼•æ“å·²é›†æˆåˆ° content.js</li>
                <li>âœ… æ™ºèƒ½æé†’è§¦å‘æœºåˆ¶å·²å®ç°</li>
                <li>âœ… è°ƒè¯•çª—å£å·²æ›´æ–°æ”¯æŒåˆ¤å®šç»“æœæ˜¾ç¤º</li>
                <li>âœ… é˜²æŠ–æœºåˆ¶å·²æ·»åŠ ï¼ˆ5åˆ†é’Ÿå†·å´æ—¶é—´ï¼‰</li>
                <li>âœ… manifest.json å·²é…ç½®æ”¯æŒåˆ¤å®šå¼•æ“åŠ è½½</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ğŸ” æµ‹è¯•éªŒè¯æ­¥éª¤</h2>

            <div class="test-item">
                <div class="test-title">1. åˆ¤å®šå¼•æ“åŠ è½½æµ‹è¯•</div>
                <div class="test-status status-pending" id="engine-load-status">å¾…æµ‹è¯•</div>
                <div class="test-actions">
                    <button onclick="testEngineLoad()">æµ‹è¯•å¼•æ“åŠ è½½</button>
                </div>
                <div class="test-output" id="engine-load-output"></div>
            </div>

            <div class="test-item">
                <div class="test-title">2. æ ¸å¿ƒæŒ‡æ ‡è·å–æµ‹è¯•</div>
                <div class="test-status status-pending" id="metrics-status">å¾…æµ‹è¯•</div>
                <div class="test-actions">
                    <button onclick="testMetrics()">æµ‹è¯•æ ¸å¿ƒæŒ‡æ ‡</button>
                </div>
                <div class="test-output" id="metrics-output"></div>
            </div>

            <div class="test-item">
                <div class="test-title">3. åˆ¤å®šé€»è¾‘æµ‹è¯•</div>
                <div class="test-status status-pending" id="judgment-status">å¾…æµ‹è¯•</div>
                <div class="test-actions">
                    <button onclick="testJudgment()">æµ‹è¯•åˆ¤å®šé€»è¾‘</button>
                </div>
                <div class="test-output" id="judgment-output"></div>
            </div>

            <div class="test-item">
                <div class="test-title">4. æ™ºèƒ½æé†’è§¦å‘æµ‹è¯•</div>
                <div class="test-status status-pending" id="reminder-status">å¾…æµ‹è¯•</div>
                <div class="test-actions">
                    <button onclick="testReminder()">æµ‹è¯•æ™ºèƒ½æé†’</button>
                </div>
                <div class="test-output" id="reminder-output"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h2>
            <div class="test-item">
                <div class="test-title">å®é™…ä½¿ç”¨æ­¥éª¤</div>
                <ol>
                    <li>åœ¨Chromeä¸­åŠ è½½ä¹¦ç­¾ç®¡ç†å™¨æ‰©å±•</li>
                    <li>è®¿é—®ä»»æ„ç½‘é¡µï¼Œç­‰å¾…åˆ¤å®šå¼•æ“åŠ è½½</li>
                    <li>åœ¨é¡µé¢ä¸­å³ä¸‹è§’ä¼šæ˜¾ç¤ºè°ƒè¯•çª—å£</li>
                    <li>è°ƒè¯•çª—å£ä¼šå®æ—¶æ˜¾ç¤º3å¤§æŒ‡æ ‡æ•°æ®</li>
                    <li>å½“åˆ¤å®šè¾¾åˆ°"é«˜åº¦å…³æ³¨"çº§åˆ«æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ”¶è—æé†’</li>
                </ol>

                <div class="test-title">è°ƒè¯•å‘½ä»¤ï¼ˆåœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ä½¿ç”¨ï¼‰</div>
                <ul>
                    <li><code>window.testCoreMetrics()</code> - æµ‹è¯•æ ¸å¿ƒæŒ‡æ ‡è·å–</li>
                    <li><code>window.testSmartReminder()</code> - æµ‹è¯•æ™ºèƒ½æé†’è§¦å‘</li>
                    <li><code>window.showDebugWindow()</code> - æ˜¾ç¤ºè°ƒè¯•çª—å£</li>
                    <li><code>window.removeDebugWindow()</code> - ç§»é™¤è°ƒè¯•çª—å£</li>
                </ul>

                <div class="test-title">åˆ¤å®šè§„åˆ™è¯´æ˜</div>
                <ul>
                    <li><strong>ä¼˜å…ˆçº§ï¼š</strong> è®¿é—®æ¬¡æ•° &gt; è®¿é—®æ—¶é•¿ &gt; è®¿é—®æ·±åº¦</li>
                    <li><strong>æƒé‡ï¼š</strong> è®¿é—®æ¬¡æ•°50%ï¼Œè®¿é—®æ—¶é•¿30%ï¼Œè®¿é—®æ·±åº¦20%</li>
                    <li><strong>è§¦å‘æ¡ä»¶ï¼š</strong> è¾¾åˆ°"é«˜åº¦å…³æ³¨"çº§åˆ«ï¼ˆLevel 2+ï¼‰</li>
                    <li><strong>å†·å´æ—¶é—´ï¼š</strong> 5åˆ†é’Ÿå†…ä¸é‡å¤è§¦å‘</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•åˆ¤å®šå¼•æ“åŠ è½½
        async function testEngineLoad() {
            const statusEl = document.getElementById('engine-load-status');
            const outputEl = document.getElementById('engine-load-output');

            try {
                // å°è¯•ä»Chromeæ‰©å±•åŠ è½½åˆ¤å®šå¼•æ“
                const script = document.createElement('script');
                script.src = chrome.runtime.getURL('metrics-judgment-engine.js');

                await new Promise((resolve, reject) => {
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });

                if (window.MetricsJudgmentEngine) {
                    statusEl.textContent = 'âœ… é€šè¿‡';
                    statusEl.className = 'test-status status-passed';
                    outputEl.textContent = 'åˆ¤å®šå¼•æ“æˆåŠŸåŠ è½½\n' +
                        'MetricsJudgmentEngine ç±»å¯ç”¨\n' +
                        'åˆ¤å®šå¼•æ“å·²å‡†å¤‡å°±ç»ª';
                } else {
                    throw new Error('å¼•æ“ç±»æœªæ‰¾åˆ°');
                }
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'test-status status-failed';
                outputEl.textContent = 'é”™è¯¯: ' + error.message + '\n' +
                    'è¯·ç¡®ä¿ï¼š\n' +
                    '1. åœ¨Chromeæ‰©å±•ç¯å¢ƒä¸­è¿è¡Œ\n' +
                    '2. metrics-judgment-engine.jsæ–‡ä»¶å­˜åœ¨\n' +
                    '3. manifest.jsonå·²æ­£ç¡®é…ç½®';
            }
        }

        // æµ‹è¯•æ ¸å¿ƒæŒ‡æ ‡è·å–
        async function testMetrics() {
            const statusEl = document.getElementById('metrics-status');
            const outputEl = document.getElementById('metrics-output');

            try {
                if (!window.MetricsJudgmentEngine) {
                    throw new Error('åˆ¤å®šå¼•æ“æœªåŠ è½½');
                }

                // æ¨¡æ‹Ÿæ ¸å¿ƒæŒ‡æ ‡æ•°æ®
                const mockMetrics = {
                    visitCount: 8,
                    browseDuration: 95,
                    browseDepth: 4.2
                };

                const engine = new window.MetricsJudgmentEngine();
                const result = engine.judge(mockMetrics);

                statusEl.textContent = 'âœ… é€šè¿‡';
                statusEl.className = 'test-status status-passed';
                outputEl.textContent = 'æµ‹è¯•æ•°æ®: ' + JSON.stringify(mockMetrics, null, 2) + '\n\n' +
                    'åˆ¤å®šç»“æœ: ' + JSON.stringify({
                        passed: result.passed,
                        level: result.level,
                        levelName: result.levelName,
                        weightedScore: result.weightedScore,
                        confidence: result.confidence
                    }, null, 2);
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'test-status status-failed';
                outputEl.textContent = 'é”™è¯¯: ' + error.message;
            }
        }

        // æµ‹è¯•åˆ¤å®šé€»è¾‘
        async function testJudgment() {
            const statusEl = document.getElementById('judgment-status');
            const outputEl = document.getElementById('judgment-output');

            try {
                if (!window.MetricsJudgmentEngine) {
                    throw new Error('åˆ¤å®šå¼•æ“æœªåŠ è½½');
                }

                const engine = new window.MetricsJudgmentEngine();
                const testCases = [
                    { name: 'ä½å…³æ³¨', data: { visitCount: 2, browseDuration: 25, browseDepth: 1.0 } },
                    { name: 'åŸºç¡€å…³æ³¨', data: { visitCount: 4, browseDuration: 45, browseDepth: 2.0 } },
                    { name: 'é«˜åº¦å…³æ³¨', data: { visitCount: 10, browseDuration: 100, browseDepth: 6.0 } },
                    { name: 'æåº¦å…³æ³¨', data: { visitCount: 25, browseDuration: 200, browseDepth: 15.0 } }
                ];

                let results = '';
                testCases.forEach(testCase => {
                    const result = engine.judge(testCase.data);
                    results += `${testCase.name}: ${result.levelName} (åˆ†æ•°: ${result.weightedScore.toFixed(2)})\n`;
                });

                statusEl.textContent = 'âœ… é€šè¿‡';
                statusEl.className = 'test-status status-passed';
                outputEl.textContent = results;
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'test-status status-failed';
                outputEl.textContent = 'é”™è¯¯: ' + error.message;
            }
        }

        // æµ‹è¯•æ™ºèƒ½æé†’
        async function testReminder() {
            const statusEl = document.getElementById('reminder-status');
            const outputEl = document.getElementById('reminder-output');

            try {
                if (!window.MetricsJudgmentEngine) {
                    throw new Error('åˆ¤å®šå¼•æ“æœªåŠ è½½');
                }

                // åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®
                const mockMetrics = {
                    visitCount: 12,
                    browseDuration: 120,
                    browseDepth: 8.0
                };

                const engine = new window.MetricsJudgmentEngine();
                const result = engine.judge(mockMetrics);

                statusEl.textContent = 'âœ… é€šè¿‡';
                statusEl.className = 'test-status status-passed';
                outputEl.textContent = 'æ™ºèƒ½æé†’è§¦å‘æ¡ä»¶éªŒè¯:\n\n' +
                    'æµ‹è¯•æ•°æ®: ' + JSON.stringify(mockMetrics, null, 2) + '\n\n' +
                    'åˆ¤å®šç»“æœ:\n' +
                    `- é€šè¿‡åˆ¤å®š: ${result.passed ? 'æ˜¯' : 'å¦'}\n` +
                    `- å…³æ³¨çº§åˆ«: ${result.levelName}\n` +
                    `- åˆ†æ•°: ${result.weightedScore.toFixed(2)}/4.0\n` +
                    `- ç½®ä¿¡åº¦: ${(result.confidence * 100).toFixed(1)}%\n\n` +
                    'æé†’è§¦å‘: ' + (result.level >= 2 ? 'âœ… ä¼šè§¦å‘' : 'âŒ ä¸ä¼šè§¦å‘');
            } catch (error) {
                statusEl.textContent = 'âŒ å¤±è´¥';
                statusEl.className = 'test-status status-failed';
                outputEl.textContent = 'é”™è¯¯: ' + error.message;
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            console.log('3å¤§æŒ‡æ ‡åˆ¤å®šå¼•æ“é›†æˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>