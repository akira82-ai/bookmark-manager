<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能提醒测试页面</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .primary-btn {
            background: #4299e1;
            color: white;
        }
        .primary-btn:hover {
            background: #3182ce;
        }
        .secondary-btn {
            background: #e2e8f0;
            color: #4a5568;
        }
        .secondary-btn:hover {
            background: #cbd5e0;
        }
        .danger-btn {
            background: #f56565;
            color: white;
        }
        .danger-btn:hover {
            background: #e53e3e;
        }
        .log-area {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        .success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .info {
            background: #bee3f8;
            color: #2a4365;
            border: 1px solid #90cdf4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧠 智能提醒测试页面</h1>
        
        <div id="status" class="status info">
            请确保已安装书签管理器扩展，然后点击下方按钮进行测试
        </div>
        
        <div class="button-group">
            <button class="primary-btn" onclick="testReminder()">🧪 测试提醒功能</button>
            <button class="secondary-btn" onclick="getDebugData()">📊 获取调试数据</button>
            <button class="secondary-btn" onclick="clearData()">🗑️ 清空数据</button>
            <button class="danger-btn" onclick="simulateVisits()">🔄 模拟访问</button>
        </div>
        
        <div class="button-group">
            <button class="secondary-btn" onclick="visitXDomain()">🌐 访问 x.com</button>
            <button class="secondary-btn" onclick="addTestBookmark()">📌 添加测试书签</button>
        </div>
        
        <h3>📝 调试日志</h3>
        <div id="log" class="log-area"></div>
    </div>

    <script>
        let logCount = 0;
        
        function log(message, type = 'info') {
            const logArea = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#fc8181' : type === 'success' ? '#68d391' : '#90cdf4';
            logArea.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        async function testReminder() {
            log('发送测试提醒请求...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'testReminder' });
                log('测试提醒请求已发送', 'success');
                updateStatus('测试提醒已触发，请查看右上角是否出现弹窗', 'success');
            } catch (error) {
                log(`测试提醒失败: ${error.message}`, 'error');
                updateStatus('测试失败，请确保扩展已正确安装', 'error');
            }
        }
        
        async function getDebugData() {
            log('获取调试数据...');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'debugData' });
                log('调试数据:', 'info');
                log(`域名数据: ${JSON.stringify(response.domainData, null, 2)}`, 'info');
                log(`URL数据: ${JSON.stringify(response.urlData, null, 2)}`, 'info');
                log(`设置: ${JSON.stringify(response.settings, null, 2)}`, 'info');
                updateStatus('调试数据已获取，请查看控制台日志', 'success');
            } catch (error) {
                log(`获取调试数据失败: ${error.message}`, 'error');
                updateStatus('获取调试数据失败', 'error');
            }
        }
        
        async function clearData() {
            log('清空提醒数据...');
            try {
                await chrome.storage.local.remove(['reminderData']);
                log('提醒数据已清空', 'success');
                updateStatus('提醒数据已清空，需要重新加载扩展', 'success');
            } catch (error) {
                log(`清空数据失败: ${error.message}`, 'error');
                updateStatus('清空数据失败', 'error');
            }
        }
        
        async function simulateVisits() {
            log('模拟访问x.com...');
            try {
                // 模拟多次访问
                for (let i = 0; i < 3; i++) {
                    await chrome.runtime.sendMessage({
                        action: 'quickAddBookmark',
                        data: {
                            title: `X.com Page ${i}`,
                            url: `https://x.com/page${i}`
                        }
                    });
                    log(`模拟访问 x.com/page${i}`, 'info');
                }
                log('模拟访问完成，等待30秒后检查提醒条件', 'success');
                updateStatus('模拟访问完成，提醒将在30秒内触发', 'success');
            } catch (error) {
                log(`模拟访问失败: ${error.message}`, 'error');
                updateStatus('模拟访问失败', 'error');
            }
        }
        
        async function visitXDomain() {
            log('打开 x.com...');
            try {
                await chrome.tabs.create({ url: 'https://x.com' });
                log('已打开 x.com 标签页', 'success');
                updateStatus('已打开 x.com，请在该页面上多次刷新以触发提醒', 'success');
            } catch (error) {
                log(`打开 x.com 失败: ${error.message}`, 'error');
                updateStatus('打开 x.com 失败', 'error');
            }
        }
        
        async function addTestBookmark() {
            log('添加测试书签到最近收藏...');
            try {
                const response = await chrome.runtime.sendMessage({
                    action: 'addBookmarkFromReminder',
                    data: {
                        title: '测试书签 - ' + new Date().toLocaleTimeString(),
                        url: 'https://example.com/test'
                    }
                });
                log('测试书签已添加', 'success');
                updateStatus('测试书签已添加到最近收藏', 'success');
            } catch (error) {
                log(`添加测试书签失败: ${error.message}`, 'error');
                updateStatus('添加测试书签失败', 'error');
            }
        }
        
        // 页面加载时的初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('测试页面已加载', 'success');
            updateStatus('测试页面已准备就绪', 'success');
        });
    </script>
</body>
</html>